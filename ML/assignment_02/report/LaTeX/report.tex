\documentclass[twoside, a4paper, fleqn, reqno]{article}
\usepackage[
	assignmentNumber=2, 
	authorZero={Stijn Kammer},
	studentNumberZero={4986296},	
	authorOne={Ramon Kits},
	studentNumberOne={5440769},
	groupNumber={31}
]{reportStyle}

\begin{document}

\maketitle

\section{Introduction}
In this report, results of the second assignment of the course Machine Learning will be discussed.
The assignment was to implement the agglomerative hierarchical clustering algorithm.
Different linkage methods were implemented and tested on the dataset delivered by the course.
The results of the different linkage methods and finding the optimal number
of clusters are discussed in this report.

\section{Methods}
The agglomerative hierarchical clustering algorithm is an iterative algorithm which
starts with each data point in its own cluster.
The algorithm then iteratively merges the two closest clusters.
The distance between two clusters is defined by the linkage method.
The algorithm stops when all data points are in one cluster.
After the algorithm has finished, the data points are clustered in a tree structure.
The tree structure can be used to find the optimal number of clusters.
Four linkage methods that may be used are single, complete, average and ward's linkage.
\par
Single linkage uses the minimum distance between objects in two clusters.
To determine the distance between two clusters, the minimum distance between
all objects in the two clusters is used. This works well for clusters that are
clearly separated.
Complete linkage uses the maximum distance between objects in two clusters.
To determine the distance between two clusters, the maximum distance between
all objects in the two clusters is used, this is the opposite of single linkage.
This can lead to clusters that are very spread out because clusters with closer
objects may not be merged because it has objects that are further away.
Both of the last two linkage methods are higly sensitive to outliers and noise.
Average linkage uses the average distance between objects in two clusters.
It uses the average distance between all objects in the two clusters to determine
the distance between the two clusters. This makes it more robust to outliers.
At last, ward's linkage is the most complex linkage method of the four.
It uses the variance of the clusters to determine the distance between the clusters.
The variance is the sum of the squared distances between the objects in the cluster
and the mean of the cluster. When the increase in variance is at its minimum,
the clusters will me berged. This linkage method is in many cases preferred over the other three
because it is very robust to outliers and it is more sensitive to the shape of the clusters.

\section{implementation}
For the data clustering the agglomerative hierarchical clustering algorithm was implemented.
The algorithm was implemented in Python and the results were plotted using matplotlib.
All four linkage methods were implemented and tested on the dataset delivered by the course.
Also the amount of clusters was determined using the dendrogram and the silhouette score.

\lstinputlisting[
	language=python,
	firstline=1,
	lastline=23,
	caption={Plotting the dendrogram},
	label={lst:1:dendrogram}
	]{../../code/dendrograms.py}

In \autoref{lst:1:dendrogram} the most important part of the code is shown which plots the dendrogram.
The code imports the data from the csv file and and performs hierarchical clustering using
the four linkage methods. The code then plots the dendrograms using the scipy library.
This dendrogram can be used to determine the optimal number of clusters.

\lstinputlisting[
	language=python,
	firstline=13,
	% lastline=23,
	caption={Plotting the dendrogram},
	label={lst:2:silhouette_scores}
	]{../../code/silhouette_scores.py}

In \autoref{lst:2:silhouette_scores} is the code shown which uses agglomerative hierarchical clustering
using the built-in function of sklearn and calculates the silhouette scores.
This code makes it possible to use either the silhouette calculation of the sklearn library
as well as the possibility to calculate the silhouette score manually which uses the following formula:
\begin{equation*}
S = \frac{1}{n} \sum_{i=1}^n \frac{(b_i - a_i)}{max(a_i, b_i)}
\end{equation*}
Where $a_i$ is the average distance between the object and all other objects in the same cluster.
$b_i$ is the average distance between the object and all other objects in the next nearest cluster.
And $n$ is the number of objects in the dataset.
\par
The avreage scores are calculated for the four linkage methods and a range of possible number of clusters.
After the scores are calculated, the code plots the scores using matplotlib in a bar chart.
This chart makes it easy to find the optimal number of clusters.

\lstinputlisting[
	language=python,
	% firstline=6,
	% lastline=23,
	caption={Plotting the clusters for different linkage methods},
	label={lst:3:cluster_scatters}
	]{../../code/cluster_scatters.py}

In \autoref{lst:3:cluster_scatters} the code is shown which uses agglomerative hierarchical clustering
with the four linkage methods and a range of number of clusters and plots the clusters using matplotlib.
This way it is possible to see how the clusters are formed by the different linkage methods.
\par
What the code also is able to do is manually calculating the Within Cluster Sum of Squares
\begin{equation*}
	WSS= \sum_{i = 1}^{N_C} \sum_{x \in C_i} d(X, \bar{X}_{C_i} )^2
\end{equation*}
which represents the sum of the squared distances between the objects within the cluster. 
And the Between Cluster Sum of Squares
\begin{equation*}
	BSS= \sum_{i = 1}^{N_C} \left\lvert C_i \right\rvert \cdot d(\bar{X}_{C_i},X)^2
\end{equation*}
Which represents the sum of the squared distances between the mean of the clusters and the objects in the dataset.
This applied to the different linkage methods and range of number of clusters.
These values are being printed in the console so they can be analyzed for each combination
of linkage method and number of clusters.

\section{Results}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/data_scatter.png}
	\caption{Data scatter plot}
	\label{fig:5:data_scatter}
\end{figure}

the data scatter plot is shown in \autoref{fig:5:data_scatter}.
The data is not separated in clusters.

\subsection{Dendrograms single linkage}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/dendrogram_single.png}
	\caption{Dendrogram for single linkage}
	\label{fig:1:dendrogram_single}
\end{figure}

The dendrogram for single linkage is shown in \autoref{fig:1:dendrogram_single}.
The optimal number of clusters is 3 because the distance between the clusters is the smallest at this point.
Single linkage is very sensitive to outliers and noise and this is visible in the dendrogram.
This causes outliers and noise to be in their own cluster, making it hard to get a good result.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/single_2_clusters.png}
	\caption{Single 2 clusters}
	\label{fig:12:single_2_clusters}
\end{figure}

The clusters for single linkage with 2 clusters are shown in \autoref{fig:12:single_2_clusters}.
One point is selected for a cluster and the other points are selected for the other cluster.
This is because the distance between the points is the smallest for this combination.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/single_3_clusters.png}
	\caption{Single 3 clusters}
	\label{fig:13:single_3_clusters}
\end{figure}

The clusters for single linkage with 3 clusters are shown in \autoref{fig:13:single_3_clusters}.
Here two clusters have only a single point and the third cluster has the other points.
This is because the distance between the points is the smallest for this combination.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/single_4_clusters.png}
	\caption{Single 4 clusters}
	\label{fig:14:single_4_clusters}
\end{figure}

The clusters for single linkage with 4 clusters are shown in \autoref{fig:14:single_4_clusters}.
Here three clusters have only a single point and the fourth cluster has the other points.
This is because the distance between the points is the smallest for this combination.

\subsection{Dendrograms complete linkage}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/dendrogram_complete.png}
	\caption{Dendrogram for complete linkage}
	\label{fig:2:dendrogram_complete}
\end{figure}

The dendrogram for complete linkage is shown in \autoref{fig:2:dendrogram_complete}.
The optimal number of clusters is 3 because the distance between the clusters is the smallest at this point.
The clusters are clearly separated and the clusters are not very spread out.
The clusters are more spread out than the clusters for single linkage.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/complete_2_clusters.png}
	\caption{Complete 2 clusters}
	\label{fig:9:complete_2_clusters}
\end{figure}

The clusters for complete linkage with 2 clusters are shown in \autoref{fig:9:complete_2_clusters}.
Here the points are clearly split in two clusters.
This is because the distance between the points is the smallest for this combination.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/complete_3_clusters.png}
	\caption{Complete 3 clusters}
	\label{fig:10:complete_3_clusters}
\end{figure}

The clusters for complete linkage with 3 clusters are shown in \autoref{fig:10:complete_3_clusters}.
Here the points are clearly split in three clusters.
This is because the distance between the points is the smallest for this combination.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/complete_4_clusters.png}
	\caption{Complete 4 clusters}
	\label{fig:11:complete_4_clusters}
\end{figure}

The clusters for complete linkage with 4 clusters are shown in \autoref{fig:11:complete_4_clusters}.
Here the points are clearly split in four clusters.
This is because the distance between the points is the smallest for this combination.

\subsection{Dendrograms average linkage}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/dendrogram_average.png}
	\caption{Dendrogram for average linkage}
	\label{fig:3:dendrogram_average}
\end{figure}

The dendrogram for average linkage is shown in \autoref{fig:3:dendrogram_average}.
The optimal number of clusters is 3 because the distance between the clusters is the smallest at this point.
The clusters are clearly separated and the clusters are not very spread out.
The clusters are more spread out than the clusters for complete linkage.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/average_2_clusters.png}
	\caption{Average 2 clusters}
	\label{fig:6:average_2_clusters}
\end{figure}

The clusters for average linkage with 2 clusters are shown in \autoref{fig:6:average_2_clusters}.
Here the points are clearly split in two clusters.
This is because the distance between the points is the smallest for this combination using average linkage.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/average_3_clusters.png}
	\caption{Average 3 clusters}
	\label{fig:7:average_3_clusters}
\end{figure}

The clusters for average linkage with 3 clusters are shown in \autoref{fig:7:average_3_clusters}.
Here the points are clearly split in three clusters.
This is because the distance between the points is the smallest for this combination using average linkage.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/average_4_clusters.png}
	\caption{Average 4 clusters}
	\label{fig:8:average_4_clusters}
\end{figure}

The clusters for average linkage with 4 clusters are shown in \autoref{fig:8:average_4_clusters}.
Here the points are clearly split in four clusters.
This is because the distance between the points is the smallest for this combination using average linkage.

\subsection{Dendrograms ward linkage}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/dendrogram_ward.png}
	\caption{Dendrogram for ward's linkage}
	\label{fig:4:dendrogram_ward}
\end{figure}

The dendrogram for ward's linkage is shown in \autoref{fig:4:dendrogram_ward}.
The optimal number of clusters is 3 because the distance between the clusters is the smallest at this point.
The clusters are clearly separated and the clusters are not very spread out.
The clusters are more spread out than the clusters for average linkage.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/ward_2_clusters.png}
	\caption{Ward 2 clusters}
	\label{fig:15:ward_2_clusters}
\end{figure}

The clusters for ward's linkage with 2 clusters are shown in \autoref{fig:15:ward_2_clusters}.
Here the points are clearly split in two clusters.
This is because the distance between the points is the smallest for this combination using ward's linkage.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/ward_3_clusters.png}
	\caption{Ward 3 clusters}
	\label{fig:16:ward_3_clusters}
\end{figure}

The clusters for ward's linkage with 3 clusters are shown in \autoref{fig:16:ward_3_clusters}.
Here the points are clearly split in three clusters.
This is because the distance between the points is the smallest for this combination using ward's linkage.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/ward_4_clusters.png}
	\caption{Ward 4 clusters}
	\label{fig:17:ward_4_clusters}
\end{figure}

The clusters for ward's linkage with 4 clusters are shown in \autoref{fig:17:ward_4_clusters}.
Here the points are clearly split in four clusters.
This is because the distance between the points is the smallest for this combination using ward's linkage.

\section{Discussion}

The dendrograms for the different linkages are shown in \autoref{fig:1:dendrogram_single}, \autoref{fig:2:dendrogram_complete}, \autoref{fig:3:dendrogram_average} and \autoref{fig:4:dendrogram_ward}.
The optimal number of clusters is 3 for all the linkages.
The single linkage delivers the worst results because the clusters are very spread out and the splits are higher in the dendrogram.
In dendrograms you want the split to be as close as possible to the bottom of the dendrogram.
The ward linkage delivers the best results because the clusters are not very spread out and the splits are lower in the dendrogram.
The average linkage delivers the second best results because the clusters are not very spread out and the splits are lower in the dendrogram than the sinle linkage.

\section{Bonus}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../code/output/silhoute_score.png}
	\caption{Silhoute score for different linkages and number of clusters} 
	\label{fig:18:silhoute_score}
\end{figure}

The silhoute score for different linkages and number of clusters is shown in \autoref{fig:18:silhoute_score}.
The silhoute score is a measure of how similar an object is to its own cluster compared to other clusters.
The score is the highest for ward linkage with 3 clusters.
The score is the lowest for single linkage with 3 clusters.

\section{Work distribution}

This week the work has been devided relatively equally between the group members.
Ramon has been working a bit more on the report because he has been working on the code for the dendrogram a bit more.
While Stijn has spend more time on analysing and writing the report. Causing both of us to gain the same amount of knowledge.

\end{document}